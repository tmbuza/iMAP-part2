# Using MetaPhlAn Pipeline {#metaphlan-pipeline}
- We loop through the fastq files using the following parameters.
- You can optionally customize these parameters to suit your needs.
- Note that most parameters are default setting except the *-t rel_ab_w_read_stats* which will add the read count to the output.

```bash
for i in data/*.fastq.gz
	do 
		metaphlan $i \
		--input_type fastq \
		--force \
		--bowtie2db /Volumes/SeagateTMB/metaphlan_databases/ \
		--nproc 4 \
		--stat_q 0.02 \
		--min_mapq_val 5 \
		--output_file ${i%}_metaphlan3_profile.txt \
		--bowtie2out ${i%}_metaphlan3_bowtie2out.txt \
		--biom ${i%}_metaphlan3_abundance.biom \
    -t rel_ab_w_read_stats
	done
	
# Merging the profiles tables and store in the folder named metaphlan3_profiles
mkdir -p metaphlan3_profiles
merge_metaphlan_tables.py metaphlan3_profiles/*_metaphlan3_profile*.txt > metaphlan3_profiles/merged_abundance_table.txt

```

# (PART) FUNCTIONAL PROFILING {-}
# Using HUMAnN pipeline {#humann-pipeline}

## Expected tabulated output
1. Microbial abundance, aka bugs list.
2. Gene families.
3. Pathway abundance.
4. Pathway coverage.

```bash
for i in data/*.fastq.gz;
  do
    time humann \
    -i $i \
    -o humann3_out \
    --resume \
    --threads 4 \
    --memory-use maximum \
    --input-format fastq \
    --bypass-translated-search;
  done

## Merging the tables
mkdir -p humann3_profiles
humann_join_tables --input humann3_out --output humann3_profiles/humann3_genefamilies.tsv --file_name genefamilies
humann_join_tables --input humann3_out --output humann3_profiles/humann3_pathcoverage.tsv --file_name pathcoverage
humann_join_tables --input humann3_out --output humann3_profiles/humann3_pathabundance.tsv --file_name pathabundance

```

